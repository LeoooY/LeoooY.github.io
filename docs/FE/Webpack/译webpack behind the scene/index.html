<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.62">
<title data-react-helmet="true">译webpack behind the scene | DocsShare</title><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="译webpack behind the scene | DocsShare"><meta data-react-helmet="true" name="description" content="[译] Webpack - Behind the Scenes"><meta data-react-helmet="true" property="og:description" content="[译] Webpack - Behind the Scenes"><meta data-react-helmet="true" property="og:url" content="https://leoooy.github.io//docs/FE/Webpack/译webpack behind the scene"><link data-react-helmet="true" rel="shortcut icon" href="/img/leo.png"><link data-react-helmet="true" rel="canonical" href="https://leoooy.github.io//docs/FE/Webpack/译webpack behind the scene"><link rel="stylesheet" href="/styles.fcc05d64.css">
<link rel="preload" href="/styles.da09b0aa.js" as="script">
<link rel="preload" href="/runtime~main.872dded8.js" as="script">
<link rel="preload" href="/main.2f1d5848.js" as="script">
<link rel="preload" href="/1.f45b894e.js" as="script">
<link rel="preload" href="/2.a477ba05.js" as="script">
<link rel="preload" href="/3.b78202e8.js" as="script">
<link rel="preload" href="/1be78505.89b8407a.js" as="script">
<link rel="preload" href="/171.d3ef19ea.js" as="script">
<link rel="preload" href="/935f2afb.43a6fc9a.js" as="script">
<link rel="preload" href="/17896441.30e2172e.js" as="script">
<link rel="preload" href="/17ac1549.5508642a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/leo.png" alt="My Site Logo"><strong class="navbar__title">My DocsShare</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Notes</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LeoooY" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://juejin.im/user/5bebc171e51d4511a8090edb/posts" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">掘金</a><a href="https://twitter.com/LeoY233" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/leo.png" alt="My Site Logo"><strong class="navbar__title">My DocsShare</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">Notes</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/LeoooY" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://juejin.im/user/5bebc171e51d4511a8090edb/posts" target="_blank" rel="noopener noreferrer" class="menu__link">掘金</a></li><li class="menu__list-item"><a href="https://twitter.com/LeoY233" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_1Lrw">译webpack behind the scene</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="译-webpack---behind-the-scenes"></a>[译] Webpack - Behind the Scenes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#译-webpack---behind-the-scenes" title="Direct link to heading">#</a></h1><p><a href="https://medium.com/@imranhsayed/webpack-behind-the-scenes-85333a23c0f6" target="_blank" rel="noopener noreferrer">原文链接</a>
written by Imran Sayed
3.25 2019 · 4 min read</p><p>translated by leoy
8.14 2020</p><p>这篇博客将告诉你webpack在幕后实际上是如何工作的。</p><p>有趣的是，Webpack的80％由其自己的插件系统（plugin system）组成。Webpack本身是一个事件驱动的体系结构。插件（plugin）是webpack生态系统的关键部分，为社区提供了一种强大的方式来利用webpack的编译过程。插件能够插入（hook into）每次编译中触发的关键事件。</p><p>一个名为Tapable的小型库是webpack中的核心实用程序（core utility）。 Webpack中的许多对象继承自Tapable类。 该类公开了tap，tapAsync和tapPromise方法，插件可使用这些方法注入自定义生成步骤，这些步骤将在整个编译（compilation）过程中触发。</p><p><img src="/assets/images/webpackflow-776deec8b2bd7c1a9c8d178773a7c124.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="webpack背后实际上是如何工作的？"></a>webpack背后实际上是如何工作的？<a aria-hidden="true" tabindex="-1" class="hash-link" href="#webpack背后实际上是如何工作的？" title="Direct link to heading">#</a></h3><p>简而言之，当一个模块进入webpack时，webpack编译器将其放入一个称为“ chunk”的容器中，并在该容器上执行很多插件（以对其进行分类排序和优化），然后再将其呈现给浏览器。</p><p>让我们深入了解它的工作原理，</p><p>Webpack中执行的第一个代码是Node API（你可以去看看webpack.js文件）。</p><p>让我们将步骤分为以下几步：</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="1、compiler"></a>1、Compiler<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1、compiler" title="Direct link to heading">#</a></h4><p>当一个模块加入Webpack时，首先运行的是Compiler（webpack.js中的
<code>compiler.run()</code>），这就是你的 <code>tapable</code> 实例。 它是webpack的顶层，实现webpack的中央调度（central dispatch）。 它有<a href="https://webpack.js.org/api/compiler-hooks" target="_blank" rel="noopener noreferrer">Hooks</a>-控制Webpack何时启动/停止，分发资源（assets），监视模式（watch mode）等。你可以在<code>Compiler.js</code>中找到相关的代码</p><p><img src="/assets/images/complier-28d7c69d828e1ca973f74c1dd8615451.png">
compiler.run(): node_modules/webpack/lib/webpack.js</p><p><img src="/assets/images/hooks-f5542333989e1bfaea8d7c9264be6ed7.png">
Hooks: node_modules/webpack/lib/Compiler.js</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="2、compilationdependency-graph"></a>2、Compilation/Dependency Graph <a aria-hidden="true" tabindex="-1" class="hash-link" href="#2、compilationdependency-graph" title="Direct link to heading">#</a></h4><p>然后，编译器创建Compilation。 Compilation是Webpack的核心，其过程中webpack开始构建图形（graph），将其定界（ceiling）并编译成bundles。 （Compiler和Compilation类都继承自Tapable类）</p><p><img src="/assets/images/compilation-c68c1d5b1ac08d3806fc9eedf0599658.png">
node_modules/webpack/lib/Compilation.js</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="3、resolver"></a>3、Resolver<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3、resolver" title="Direct link to heading">#</a></h4><p>当你将项目入口（entry point）传递到webpack时，它会将其提供给Resolver，后者将检查给定的部分路径是否存在，并返回完整的绝对路径以及上下文，请求，调用等额外信息。</p><p>例如，当你在nodejs中使用<code>require</code>语句，你将其发送给模块解析器以确保其存在。 （ResolverFactory.js）</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="4、module-factories"></a>4、Module Factories<a aria-hidden="true" tabindex="-1" class="hash-link" href="#4、module-factories" title="Direct link to heading">#</a></h4><p>模块工厂（Module Factories）创建模块的实例。 然后，模块工厂从解析器（Resolver）取出成功解析的（模块）请求，从该文件中收集源代码，从而创建一个模块对象/实例（NormalModuleFactory.js和ContextModuleFactory.js）</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="5、parser"></a>5、Parser<a aria-hidden="true" tabindex="-1" class="hash-link" href="#5、parser" title="Direct link to heading">#</a></h4><p>解析器从源代码中抽取字符串，并将其转换为AST（抽象语法树）（<a href="https://astexplorer.net/%EF%BC%89%E3%80%82" target="_blank" rel="noopener noreferrer">https://astexplorer.net/）。</a> Webpack有一个使用acron解析器的解析器类，该类使用由Module Factory创建的Module Object（包含源代码）并从中创建AST。 Webpack遍历整个AST。 它还从AST语句中找到所有需求和导入，并创建一个依赖图。 它将那些依赖项附加到模块。 请务必注意，如果webpack为加载程序找到了任何规则，则加载程序会将这些代码（例如css文件）转换为JavaScript，然后解析器将其解析为AST。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="6、templates"></a>6、Templates<a aria-hidden="true" tabindex="-1" class="hash-link" href="#6、templates" title="Direct link to heading">#</a></h4><p>然后，模板将为您解析的模块对象进行数据绑定，并生成您在捆绑的javascript文件中看到的代码。 它呈现一个在数组中包含模块的块。 因此，整个模块可以分为三个部分：</p><p>1-Chunk Template
2-Module Template
3-Dependency Templates</p><p>重复此过程，直到解决了所有依赖关系。 webpack的核心工作是解析文件并将所有内容捆绑在一个依赖图中。 这有助于webpack进行增量构建。 在webpack及其体系结构中提供的抽象使我们能够立即进行枢轴旋转并添加所需的任何功能。 因此，我们能够非常迅速地开发和发布。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="tree-shaking-and-dead-code-elimination"></a>Tree shaking and Dead Code Elimination<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tree-shaking-and-dead-code-elimination" title="Direct link to heading">#</a></h3><p>摇树或包含Live Code意味着Webpack静态使用语法来标识正在使用的内容，并将其仅捆绑在一起。 这意味着它将只捆绑那些在主index.js文件中导入或使用的函数或常量。</p><p>消除死代码是一种编译器优化，用于删除不影响程序结果的代码。</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#webpack背后实际上是如何工作的？" class="table-of-contents__link">webpack背后实际上是如何工作的？</a></li><li><a href="#tree-shaking-and-dead-code-elimination" class="table-of-contents__link">Tree shaking and Dead Code Elimination</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2020 LeoY233. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.da09b0aa.js"></script>
<script src="/runtime~main.872dded8.js"></script>
<script src="/main.2f1d5848.js"></script>
<script src="/1.f45b894e.js"></script>
<script src="/2.a477ba05.js"></script>
<script src="/3.b78202e8.js"></script>
<script src="/1be78505.89b8407a.js"></script>
<script src="/171.d3ef19ea.js"></script>
<script src="/935f2afb.43a6fc9a.js"></script>
<script src="/17896441.30e2172e.js"></script>
<script src="/17ac1549.5508642a.js"></script>
</body>
</html>